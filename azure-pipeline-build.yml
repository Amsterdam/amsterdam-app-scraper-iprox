pool:
  vmImage: ubuntu-latest

variables:
- group: container-registry
- name: imageName
  value: scraper-iprox
- name: tag
  value: $(imageName):$(Build.BuildNumber)
- name: unittestPassed
  value: false
- name: testBool
  value: false

steps:
- script: |   
    echo 'Building docker container with tag: $(tag)'
    docker build -f $(Build.SourcesDirectory)/build-docker-image/Dockerfile -t $(tag) .
  displayName: 'Build docker image'

- script: | 
    echo "unittestPassed: $(unittestPassed)"
    echo "testBool: $(testBool)"
    docker run -e UNITTEST=true $(tag) && unittestPassed=true
    testBool=true
    echo "unittestPassed: $(unittestPassed)"
    echo "testBool: $(testBool)"
    if [ $(unittestPassed) == 'false' ]; then
      exit 1
    fi
  displayName: 'Run unittests'