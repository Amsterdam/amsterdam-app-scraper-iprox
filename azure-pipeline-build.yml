pool:
  vmImage: ubuntu-latest

variables:
- group: container-registry
- name: imageName
  value: scraper-iprox
- name: tag
  value: $(imageName):$(Build.BuildNumber)
- name: unittestPassed
  value: false

steps:
- script: |   
    echo 'Building docker container with tag: $(tag)'
    docker build -f $(Build.SourcesDirectory)/build-docker-image/Dockerfile -t $(tag) .
  displayName: 'Build docker image'

- script: | 
    unittest_success=false
    echo "> succes: $(unittest_success)"
    docker run -e UNITTEST=true $(tag) && unittest_success=true
    echo "> succes after docker run: $(unittest_success)"
    $unittest_success=true
    echo "> succes after set var: $(unittest_success)"
    echo "unittestPassed: $(unittestPassed)"
    if [ $(unittestPassed) == 'false' ]; then
      exit 1
    fi
  displayName: 'Run unittests'